<!doctype html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Content Manager</title>

</head>

<body>
    <script src="https://unpkg.com/netlify-cms@^2.0.0/dist/netlify-cms.js"></script>
    <script>
        function formatDate(date) {
            if (!date) {
                return "";
            }
            var monthNames = [
                "January", "February", "March",
                "April", "May", "June", "July",
                "August", "September", "October",
                "November", "December"
            ];
            var monthIndex = date.getMonth();
            var year = date.getFullYear();

            return monthNames[monthIndex] + ' ' + year;
        }
        var PostPreview = createClass({
            render: function () {
                var entry = this.props.entry;
                var thumbnail = "";
                var barcode = "";
                var width = 848;
                var height = 480;
                var title = entry.getIn(['data', 'title']) ? entry.getIn(['data', 'title']) : '';
                var date = entry.getIn(['data', 'date']) ? entry.getIn(['data', 'date']) : '';
                var creators = entry.getIn(['data', 'creators']) ? entry.getIn(['data', 'creators']) : '';
                var song = entry.getIn(['data', 'song']) ? entry.getIn(['data', 'song']) : "";
                var artist = entry.getIn(['data', 'artist']) ? entry.getIn(['data', 'artist']) : "";
                var fandoms = entry.getIn(['data', 'fandoms']) ? entry.getIn(['data', 'fandoms']) : [];
                var mp4name = entry.getIn(['data', 'mp4name']) ? entry.getIn(['data', 'mp4name']) : '';
                var mp4size = entry.getIn(['data', 'mp4size']) ? entry.getIn(['data', 'mp4size']) : "100 MB";

                if (entry.getIn(['data', 'thumbnail'])) {
                    thumbnail = this.props.getAsset(entry.getIn(['data', 'thumbnail'])).toString();
                }
                if (entry.getIn(['data', 'barcode'])) {
                    barcode = this.props.getAsset(entry.getIn(['data', 'barcode'])).toString();
                }
                return h("div", { "style": { "background-image": barcode ? 'url("' + barcode + '"' : 'none', 'min-width': '100%', 'min-height': '100vh' }, "className": "t-vid-detail" },
                    h('figure', {},
                        h('div', { "className": "c-vid-detail__video" },
                            h('video', {
                                "poster": thumbnail,
                                "controls": true,
                                "preload": "metadata",
                                "width": width + "px",
                                "height": height + "px"
                            },
                                mp4name ? h('source', {
                                    "src": "/vidfiles/" + mp4name,
                                    "type": "video/mp4"
                                }) : ''
                            )
                        )
                    ),
                    h("article", { "className": "c-vid-detail" },
                        h("div.main", {},
                            h("h2", { "className": "c-vid-detail__title" },
                                entry.getIn(['data', 'title']),
                                " ",
                                h("span", { "className": "c-vid-detail__date" }, formatDate(entry.getIn(['data', 'date'])))
                            ),
                            h("div", { "className": "c-vid-detail__body" },
                                h("div", { "className": "c-vid-detail__creators" }, creators),
                                h("div", { "className": "c-vid-detail__fandoms" }, "Footage: " + fandoms.join(', ')),
                                h("div", { "className": "c-vid-detail__song" }, "Song: " + song),
                                h("div", { "className": "c-vid-detail__artist" }, "Artist: " + artist),
                                h("div", { "className": "c-vid-detail__download" },
                                    "Download: ",
                                    h("a", {
                                        "href": "/vidfiles/" + mp4name,
                                        "download": "",
                                        "className": "c-vid-detail__download-link"
                                    }, entry.getIn(['data', 'mp4name']) + "(" + mp4size + ")")
                                )
                            ),
                            h("div.post-main", {}, this.props.widgetFor('body'))
                        )
                    )
                );
            }
        });
        CMS.registerPreviewStyle("/css/base.css");
        CMS.registerPreviewTemplate("vids", PostPreview);
    </script>
</body>

</html>
